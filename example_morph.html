<h1 id="morphological-operations-example">Morphological Operations Example</h1>
<p>This example should demonstrate how to perform morphological operation on binary images in DCV, such as erode, dilate, open and close.</p>
<h2 id="modules-used">Modules used</h2>
<ul>
<li>dcv.core</li>
<li>dcv.io</li>
<li>dcv.imgproc</li>
<li>dcv.plot</li>
</ul>
<h2 id="source-image">Source Image</h2>
<p>As in other examples, here we’ll use Lena image as source (input image). We’ll convert it to grayscale, then afterwards threshold its values in a way to achieve reasonable results usable for demonstrating morphology operations.</p>
<p>Here is the grayscale:</p>
<div class="figure">
<img src="https://github.com/ljubobratovicrelja/dcv/blob/master/examples/data/lena_gray.png?raw=true" alt="alt tag" />
</div>
<h2 id="thresholding">Thresholding</h2>
<p>To apply morphological operations, we first binarize the grayscale image. With following code:</p>
<div class="sourceCode"><pre class="sourceCode d"><code class="sourceCode d"><span class="kw">auto</span> thesholded = slice.threshold!<span class="dt">ubyte</span>(<span class="dv">30</span>, <span class="dv">60</span>);</code></pre></div>
<p>… we get following image:</p>
<div class="figure">
<img src="https://github.com/ljubobratovicrelja/dcv/blob/master/examples/morph/result/thresholded.png?raw=true" alt="alt tag" />
</div>
<h2 id="morphological-ops">Morphological Ops</h2>
<p>Following functions in DCV perform morphological operations: <a href="https://ljubobratovicrelja.github.io/dcv/?loc=dcv_imgproc_filter.html#erode">erode</a>, <a href="https://ljubobratovicrelja.github.io/dcv/?loc=dcv_imgproc_filter.html#dilate">dilate</a>, <a href="https://ljubobratovicrelja.github.io/dcv/?loc=dcv_imgproc_filter.html#open">open</a>, <a href="https://ljubobratovicrelja.github.io/dcv/?loc=dcv_imgproc_filter.html#close">close</a>. Those functions have identical API - by using given kernel, apply chosen morphological operation to given image slice. Most basic kernels used in these functions would be <a href="https://ljubobratovicrelja.github.io/dcv/?loc=dcv_imgproc_filter.html#boxKernel">boxKernel</a>(or <a href="https://ljubobratovicrelja.github.io/dcv/?loc=dcv_imgproc_filter.html#radialKernel">radialKernel</a> if blocky effects are obvious), but other custom shaped kernels can be provided.</p>
<h3 id="erode">Erode</h3>
<p>In this example we erode the image with radialKernel of radius size 5:</p>
<div class="sourceCode"><pre class="sourceCode d"><code class="sourceCode d"><span class="kw">auto</span> eroded = thesholded.erode(radialKernel!<span class="dt">ubyte</span>(<span class="dv">5</span>));</code></pre></div>
<p>This gives us following result:</p>
<div class="figure">
<img src="https://github.com/ljubobratovicrelja/dcv/blob/master/examples/morph/result/eroded.png?raw=true" alt="alt tag" />
</div>
<p>When we zoom at the eye, and switch between input image, and the result we can clearly see that bordering white pixels have been “eroded”:</p>
<div class="figure">
<img src="https://github.com/ljubobratovicrelja/dcv/blob/master/examples/morph/result/erodeanim.gif?raw=true" alt="alt tag" />
</div>
<h3 id="dilate">Dilate</h3>
<p>Inverse of erosion, dilation will grow white pixel field with given kernel. In this example we use the same kernel in each morphological operation, so following command:</p>
<div class="sourceCode"><pre class="sourceCode d"><code class="sourceCode d"><span class="kw">auto</span> dilated = thesholded.dilate(radialKernel!<span class="dt">ubyte</span>(<span class="dv">5</span>));</code></pre></div>
<p>… Will produce following image:</p>
<div class="figure">
<img src="https://github.com/ljubobratovicrelja/dcv/blob/master/examples/morph/result/dilated.png?raw=true" alt="alt tag" />
</div>
<p>Same as before, we can analyze the result more closely by looking at the zoomed gif:</p>
<div class="figure">
<img src="https://github.com/ljubobratovicrelja/dcv/blob/master/examples/morph/result/dilateanim.gif?raw=true" alt="alt tag" />
</div>
<h3 id="open">Open</h3>
<p>Opening operation is used, as the name implies, to open closing forms. It will suppress slimmer edges, where concentration
of white pixels is low, but will keep overall shape of regions with denser distribution of white pixels. We'll skip the code, since its fairly similar as in dilate and erode example. Here is the opening result:</p>
<div class="figure">
<img src="https://github.com/ljubobratovicrelja/dcv/blob/master/examples/morph/result/opened.png?raw=true" alt="alt tag" />
</div>
<p>Looking at zoomed eye region, we can see that eye-line on the lower edge has disappeared, i.e. "opened":</p>
<div class="figure">
<img src="https://github.com/ljubobratovicrelja/dcv/blob/master/examples/morph/result/openanim.gif?raw=true" alt="alt tag" />
</div>
<h3 id="close">Close</h3>
<p>Opposite of the opening, closing tends to close, or fill holes in forms. Here is the result:</p>
<div class="figure">
<img src="https://github.com/ljubobratovicrelja/dcv/blob/master/examples/morph/result/closed.png?raw=true" alt="alt tag" />
</div>
<p>Effects are obvious when looking at zoomed eye region in gif comparison with the input image:</p>
<div class="figure">
<img src="https://github.com/ljubobratovicrelja/dcv/blob/master/examples/morph/result/closeanim.gif?raw=true" alt="alt tag" />
</div>

<br><span><big>Complete code:</big></span>

<div><pre style="margin: 0; line-height: 125%"><span style="color: #0000ff">module</span> dcv.example.morph;

<span style="color: #008000">/** </span>
<span style="color: #008000"> * Image morphological operations example using DCV library.</span>
<span style="color: #008000"> */</span>

<span style="color: #0000ff">import</span> dcv.core;
<span style="color: #0000ff">import</span> dcv.io;
<span style="color: #0000ff">import</span> dcv.imgproc;
<span style="color: #0000ff">import</span> dcv.plot;


<span style="color: #2b91af">void</span> main()
{
    Image image = imread(<span style="color: #a31515">&quot;../data/lena.png&quot;</span>);

    <span style="color: #0000ff">auto</span> slice = image.sliced.rgb2gray;
    <span style="color: #0000ff">auto</span> thesholded = slice.threshold!<span style="color: #2b91af">ubyte</span>(30, 60);
    <span style="color: #0000ff">auto</span> dilated = thesholded.dilate(radialKernel!<span style="color: #2b91af">ubyte</span>(5));
    <span style="color: #0000ff">auto</span> eroded = thesholded.erode(radialKernel!<span style="color: #2b91af">ubyte</span>(5));
    <span style="color: #0000ff">auto</span> opened = thesholded.open(radialKernel!<span style="color: #2b91af">ubyte</span>(5));
    <span style="color: #0000ff">auto</span> closed = thesholded.close(radialKernel!<span style="color: #2b91af">ubyte</span>(5));

    slice.imshow(<span style="color: #a31515">&quot;Original&quot;</span>);
    thesholded.imshow(<span style="color: #a31515">&quot;Thresholded&quot;</span>);
    dilated.imshow(<span style="color: #a31515">&quot;Dilated&quot;</span>);
    eroded.imshow(<span style="color: #a31515">&quot;Eroded&quot;</span>);
    opened.imshow(<span style="color: #a31515">&quot;Opened&quot;</span>);
    closed.imshow(<span style="color: #a31515">&quot;Closed&quot;</span>);

    waitKey();
}
</pre></div>
